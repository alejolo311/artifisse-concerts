<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artífisse Concert</title>
    <link rel="shortcut icon" href="../img/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/streaming.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>

<body>

    <header class="header" id="header">

        <img src="../img/artifisse-logo.png" alt="Artífisse logo">
        <div class="header-info">
            Tus artistas favoritos, en tu propia casa
        </div>

    </header>

    <section>

        <div class="content">

            <!-- VIDEOSTREAMING -->

            <div class="video" id="video">
                <iframe src="//iframe.dacast.com/b/175060/c/554405" frameborder="0" scrolling="no" allow="autoplay" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
            </div>


            <!-- CHAT -->

            <div class="chatbox" id="chatbox">

                <div class="chatlogs" id="chatlogs">                
                </div>
                <form class="chat-form" action="">
                    <textarea id="form-message"></textarea>
                    <button type="submit" class="chat-btn" id="chat-btn">Enviar</button>
                </form>            
            </div>

            <!---------------------------------------------------------->
    
        </div>

    </section>

    <footer class="footer">
        <div class="footer-info">
            © 2020    |    Artífisse    |    Colombia    |    Todos los derechos reservados
        </div>					
    </footer>
    <script>
        $(function () {
            let socket = io();
            let name;
            var $scroll_down_chat = $('#chatlogs');
            if (getCookie("username") === "")
            {
                name = prompt('Cual es tu nombre de usuario?')
                socket.emit('new-user', name)
                document.cookie = "username=" + name;
            }
            else {
                name = getCookie("username")
            }
            $('form').submit(function(e) {
                e.preventDefault();
                if ($('#form-message').val().length == 0)
                {
                    return false;
                }
                socket.emit('send-chat-message', $('#form-message').val());
                $('#chatlogs').append("<div class='chat user'><p class='chat-message'>" + "<b>" + name + ": "+ $('#form-message').val() + "<p></div>");
                $('#form-message').val('');
                $scroll_down_chat.animate({ scrollTop: $scroll_down_chat[0].scrollHeight }, 'fast');
                return false;
            });
            socket.on('chat-message', function(data){
                $('#chatlogs').append("<div class='chat self'><p class='chat-message'>" + "<b>" + data.name + "</b>" + ": "+ data.message + "<p></div>");
                $scroll_down_chat.animate({ scrollTop: $scroll_down_chat[0].scrollHeight }, 'fast');
            });
            window.addEventListener('keypress', function (e) {
                if (e.keyCode === 13) {
                    e.preventDefault();
                    if ($('#form-message').val().length == 0)
                    {
                        return false;
                    }
                    socket.emit('send-chat-message', $('#form-message').val());
                    $('#chatlogs').append("<div class='chat user'><p class='chat-message'>" + "<b>" + name + ": "+ $('#form-message').val() + "<p></div>");
                    $('#form-message').val('');
                    $scroll_down_chat.animate({ scrollTop: $scroll_down_chat[0].scrollHeight }, 'fast');
                    return false;
                }
            }, false);

            
        });
        function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for(var i = 0; i <ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
            c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
            }
        }
        return "";
        }
    </script>
    

</body>

</html>